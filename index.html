<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QC with PWA</title>

  <link rel="canonical" href="https://mchodk.github.io/PWA_QC/" />
  <link rel="manifest" href="/PWA_QC/manifest.webmanifest">

<style>
* {
  box-sizing: border-box;
}
body { font-family: Arial, sans-serif; padding: 20px; margin: 0; background-color: #f2f2f2; }
.view { display: none; }
.view.active { display: block; }

.checkbox-group { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
button { background-color: #007BFF; color: white; padding: 10px 20px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; width: 100%; margin-bottom: 10px; }
button:disabled { background-color: #aaa; }
.center-text { text-align: center; font-size: 20px; margin-bottom: 20px; }
#startView .center-text:first-of-type { font-size: 28px; font-weight: bold; }
#startButton { font-size: 22px; padding: 15px 20px; }
#report { background: white; padding: 15px; border-radius: 10px; }
.ok { color: green; }
.nok { color: red; }
#userBadge {
  position: fixed;
  top: 10px;
  right: 15px;
  background: #007BFF;
  color: white;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 16px;          /* rozmiar tekstu nazwy użytkownika */
  font-weight: bold;
  z-index: 1000;
  display: none;             /* ukryte dopóki użytkownik się nie zaloguje */
  display: flex;
  align-items: center;       /* wyrównanie pionowe wszystkich elementów */
  gap: 8px;
}

#userName {
  display: inline-block;
  line-height: 1;           /* wyrównanie tekstu w badge */
}

#logoutBtn {
  background: transparent;
  border: none;
  color: white;
  cursor: pointer;
  font-size: 28px;          /* rozmiar ikonki */
  padding: 0;
  line-height: 1;           /* wyrównanie ikonki */
}
#logoutBtn:hover {
  color: #ffd700;
  transform: scale(1.15);
}
</style>
</head>

<body>
<div id="userBadge">
  <span id="userName"></span>
  <button id="logoutBtn" title="Wyloguj" aria-label="Wyloguj">⎋</button>
</div>

<!-- LOGIN -->
<div class="view active" id="loginView">
  <div class="center-text" style="font-size:28px;font-weight:bold;">Logowanie</div>

  <div class="checkbox-group">
    <label>Użytkownik:</label><br>
    <select id="loginUser" style="width:100%; padding:10px; margin-bottom:10px;">
      <option value="">-- wybierz --</option>
      <option value="test_user">test_user</option>
      <option value="test_lift">test_lift</option>
    </select>

    <label>Hasło:</label><br>
    <input type="password" id="loginPass" style="width:100%; padding:10px;">
    <div id="loginError" style="color:red; margin-top:10px; display:none;">
      Nieprawidłowy użytkownik lub hasło
    </div>
  </div>

  <button id="loginButton">Zaloguj</button>
</div>

<!-- START -->
<div class="view" id="startView">
  <div class="center-text">
    <img src="https://www.lift.pl/images/logo.png" style="max-width:100%; margin-bottom:20px;">
  </div>
  <div class="center-text">Zaczynamy</div>
  <div class="center-text">Wybierz jedną opcję:</div>
  <div class="checkbox-group" style="background:#e0e0e0;">
    <label><input type="checkbox" class="startOption" data-target="viewOpt1"> Opcja 1</label><br>
    <label><input type="checkbox" class="startOption" data-target="viewOpt2"> Opcja 2</label><br>
    <label><input type="checkbox" class="startOption" data-target="viewOpt3"> Opcja 3</label>
  </div>
  
  <!-- PODOPCJE DLA OPCJI 2 -->
  <div class="checkbox-group" id="subOptions2" style="display:none; background:#d0f0ff;">
  <div class="center-text">Wybierz podopcję:</div>
  <label><input type="checkbox" class="subOption2" data-value="A"> Podopcja A</label><br>
  <label><input type="checkbox" class="subOption2" data-value="B"> Podopcja B</label>
</div>
  
  <button id="startButton" disabled>Start</button>
</div>

<!-- OPCJE -->
<div class="view" id="viewOpt1">
  <div class="checkbox-group">
    <label><input type="checkbox" class="cbOpt1"> Sprawdzono 1A</label><br>
    <label><input type="checkbox" class="cbOpt1"> Sprawdzono 1B</label><br>
    <label><input type="checkbox" class="cbOpt1"> Sprawdzono 1C</label>
  </div>
  <button id="nextOpt1">Dalej</button>
</div>

<div class="view" id="viewOpt2">
  <div class="checkbox-group">
    <label><input type="checkbox" class="cbOpt2"> Sprawdzono 2A</label><br>
    <label><input type="checkbox" class="cbOpt2"> Sprawdzono 2B</label><br>
    <label><input type="checkbox" class="cbOpt2"> Sprawdzono 2C</label>
    
    <!-- DYNAMICZNE CHECKBOXY POD OPCJĄ 2 -->
    <div id="extraOpt2"></div>
  </div>
  <button id="nextOpt2">Dalej</button>
</div>

<div class="view" id="viewOpt3">
  <div class="checkbox-group">
    <label><input type="checkbox" class="cbOpt3"> Sprawdzono 3A</label><br>
    <label><input type="checkbox" class="cbOpt3"> Sprawdzono 3B</label><br>
    <label><input type="checkbox" class="cbOpt3"> Sprawdzono 3C</label>
  </div>
  <button id="nextOpt3">Dalej</button>
</div>

<!-- RAPORT -->
<div class="view" id="endView">
  <div class="center-text" style="font-size:24px;font-weight:bold;">Raport</div>
  <div id="report"></div>
  <button id="downloadPDF">Pobierz PDF</button>
  <button id="restartButton">Powrót do startu</button>
</div>

<!-- html2pdf.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
let selectedStartOption = "";
let selectedGroup = "";
let loggedUser = "";

/* LOGIN */
const users = {
  test_user: "user",
  test_lift: "lift"
};

function showUser(user) {
  loggedUser = user;
  localStorage.setItem("loggedUser", user);

  document.getElementById('userName').textContent = user;
  document.getElementById('userBadge').style.display = "flex";
}

function logout() {
    loggedUser = "";
  localStorage.removeItem("loggedUser");

  // ukryj badge
  document.getElementById('userBadge').style.display = "none";

  // reset zmiennych
  selectedStartOption = "";
  selectedGroup = "";

  // odznacz WSZYSTKIE checkboxy
  document.querySelectorAll('input[type=checkbox]').forEach(cb => cb.checked = false);

  // ukryj podopcje Opcji 2
  subOptions2Div.style.display = 'none';
  subOptions2.forEach(s => s.checked = false);

  // reset pól logowania
  document.getElementById('loginUser').value = "";
  document.getElementById('loginPass').value = "";

  // wyczyść raport
  document.getElementById('report').innerHTML = "";

  // przywróć przyciski start / next
  startButton.disabled = true;
  ['nextOpt1','nextOpt2','nextOpt3','downloadPDF'].forEach(id => {
    const btn = document.getElementById(id);
    if (btn) btn.disabled = false;
  });

  // pokaż widok logowania
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById('loginView').classList.add('active');
}

document.getElementById('loginButton').onclick = () => {
  const user = document.getElementById('loginUser').value;
  const pass = document.getElementById('loginPass').value;
  const error = document.getElementById('loginError');

  if (users[user] && users[user] === pass) {
    error.style.display = "none";
  
    showUser(user); 
  
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    document.getElementById('startView').classList.add('active');
  }else {
    error.style.display = "block"; //  pokaż błąd
  }
};

document.getElementById('logoutBtn').onclick = logout;

// === START OPTIONS I PODOPCJE OPCJI 2 ===
const startOptions = document.querySelectorAll('.startOption');
const startButton = document.getElementById('startButton');
const subOptions2Div = document.getElementById('subOptions2');
const subOptions2 = document.querySelectorAll('.subOption2');

startOptions.forEach(cb => {
  cb.addEventListener('change', () => {
    // odznacz inne opcje
    startOptions.forEach(o => o !== cb && (o.checked = false));

    selectedStartOption = cb.parentElement.textContent.trim();
    selectedGroup = cb.dataset.target;

    // Start zawsze aktywny jeśli zaznaczono opcję
    startButton.disabled = !cb.checked;

    if (selectedGroup === 'viewOpt2' && cb.checked) {
      // Opcja 2 zaznaczona → pokaż podopcje
      subOptions2Div.style.display = 'block';
    } else {
      // Opcja 2 odznaczona lub inna opcja → ukryj podopcje
      subOptions2Div.style.display = 'none';
      subOptions2.forEach(s => s.checked = false);
    }
  });
});

// obsługa podopcji Opcji 2
subOptions2.forEach(s => {
  s.addEventListener('change', () => {
    // tylko jedna podopcja może być zaznaczona
    subOptions2.forEach(o => o !== s && (o.checked = false));
    if (s.checked) selectedStartOption = `Opcja 2 - Podopcja ${s.dataset.value}`;
    else selectedStartOption = 'Opcja 2';
  });
});

// przycisk Start
startButton.onclick = () => {
  // przed zmianą widoku
  if (selectedGroup === 'viewOpt2') {
    const extraDiv = document.getElementById('extraOpt2');
    extraDiv.innerHTML = ''; // wyczyść poprzednie checkboxy

    if (selectedStartOption.includes('Podopcja A')) {
      extraDiv.innerHTML = `
        <label><input type="checkbox" class="extraOpt2"> Opcja A1</label><br>
        <label><input type="checkbox" class="extraOpt2"> Opcja A2</label>
      `;
    } else if (selectedStartOption.includes('Podopcja B')) {
      extraDiv.innerHTML = `
        <label><input type="checkbox" class="extraOpt2"> Opcja B1</label><br>
        <label><input type="checkbox" class="extraOpt2"> Opcja B2</label>
      `;
    }
  }

  // pokaż wybrany widok
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById(selectedGroup).classList.add('active');
};


['1','2','3'].forEach(n => {
  document.querySelectorAll(`.cbOpt${n}`).forEach(cb =>
    cb.addEventListener('change', () => enableIfAnyChecked(`cbOpt${n}`, `nextOpt${n}`))
  );
  document.getElementById(`nextOpt${n}`).onclick = showEndView;
});

/* RAPORT */
function showEndView() {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById('endView').classList.add('active');

let checkboxes;
if (selectedGroup === 'viewOpt1') {
  checkboxes = document.querySelectorAll('.cbOpt1');
} else if (selectedGroup === 'viewOpt2') {
  // zbierz standardowe cbOpt2 + dynamiczne extraOpt2
  checkboxes = document.querySelectorAll('.cbOpt2, .extraOpt2');
} else {
  checkboxes = document.querySelectorAll('.cbOpt3');
}

  let html = `<strong>Wybrana opcja:</strong> ${selectedStartOption}<br><br><ul>`;
  checkboxes.forEach(cb => {
    html += `<li class="${cb.checked ? 'ok' : 'nok'}">
      ${cb.checked ? '✔' : '✖'} ${cb.parentElement.textContent.trim()}
    </li>`;
  });
  html += `</ul>
<br>
<strong>Zatwierdził:</strong> ${loggedUser}`;
  document.getElementById('report').innerHTML = html;
}

/* PDF */
document.getElementById('downloadPDF').onclick = () => {
  // Pobranie aktualnej daty i czasu
const now = new Date();
const yearTwoDigits = String(now.getFullYear()).slice(-2); // "26"
const dateStr = yearTwoDigits + '-' +
                String(now.getMonth() + 1).padStart(2, '0') + '-' +
                String(now.getDate()).padStart(2, '0') + '_' +
                String(now.getHours()).padStart(2, '0') +
                String(now.getMinutes()).padStart(2, '0');

  // Pobranie elementu raportu
  const element = document.getElementById('report');

  // Generowanie PDF z dynamiczną nazwą
  html2pdf().from(element).set({
    margin: 0.5,
    filename: `raport_${dateStr}.pdf`,
    html2canvas: { scale: 2 },
    jsPDF: { orientation: 'portrait', unit: 'in', format: 'letter' }
  }).save();
};

/* RESET – działa zawsze */
document.getElementById('restartButton').onclick = () => {
  // reset zmiennych
  selectedStartOption = "";
  selectedGroup = "";

  // odznacz wszystkie checkboxy
  document.querySelectorAll('input[type=checkbox]').forEach(cb => cb.checked = false);

  // ukryj podopcje Opcji 2
  subOptions2Div.style.display = 'none';
  subOptions2.forEach(s => s.checked = false);

  // reset przycisków
  startButton.disabled = true;
  ['nextOpt1','nextOpt2','nextOpt3','downloadPDF'].forEach(id => {
    document.getElementById(id).disabled = false; // PDF zawsze aktywny przy nowym raporcie
  });

  // ukryj wszystkie widoki
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));

  // wyczyść raport
  document.getElementById('report').innerHTML = "";

  // pokaż start
  document.getElementById('startView').classList.add('active');
};

      if (navigator.serviceWorker) {
        navigator.serviceWorker.register (
          'sw.js',
          {scope: './'}
        )
      }

document.addEventListener("DOMContentLoaded", () => {
  const savedUser = localStorage.getItem("loggedUser");
  if (savedUser) {
    showUser(savedUser);

    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    document.getElementById('startView').classList.add('active');
  }
});
</script>

</body>
</html>
